{"version":3,"file":"gbsdk.umd.js","sources":["../node_modules/whatwg-fetch/dist/fetch.umd.js","../src/gbsdk.ts"],"sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.WHATWGFetch = {})));\n}(this, (function (exports) { 'use strict';\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob();\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  };\n\n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ];\n\n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift();\n        return {done: value === undefined, value: value}\n      }\n    };\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      };\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ', ' + value : value;\n  };\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null\n  };\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  };\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push(name);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.values = function() {\n    var items = [];\n    this.forEach(function(value) {\n      items.push(value);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.entries = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push([name, value]);\n    });\n    return iteratorFor(items)\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result);\n      };\n      reader.onerror = function() {\n        reject(reader.error);\n      };\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function(body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body);\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      };\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      };\n    }\n\n    this.text = function() {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      };\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    };\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      this.signal = input.signal;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'same-origin';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.signal = options.signal || this.signal;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=');\n          var name = split.shift().replace(/\\+/g, ' ');\n          var value = split.join('=').replace(/\\+/g, ' ');\n          form.append(decodeURIComponent(name), decodeURIComponent(value));\n        }\n      });\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  };\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''});\n    response.type = 'error';\n    return response\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  };\n\n  exports.DOMException = self.DOMException;\n  try {\n    new exports.DOMException();\n  } catch (err) {\n    exports.DOMException = function(message, name) {\n      this.message = message;\n      this.name = name;\n      var error = Error(message);\n      this.stack = error.stack;\n    };\n    exports.DOMException.prototype = Object.create(Error.prototype);\n    exports.DOMException.prototype.constructor = exports.DOMException;\n  }\n\n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init);\n\n      if (request.signal && request.signal.aborted) {\n        return reject(new exports.DOMException('Aborted', 'AbortError'))\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      function abortXhr() {\n        xhr.abort();\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        };\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.onabort = function() {\n        reject(new exports.DOMException('Aborted', 'AbortError'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr);\n\n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr);\n          }\n        };\n      }\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    })\n  }\n\n  fetch.polyfill = true;\n\n  if (!self.fetch) {\n    self.fetch = fetch;\n    self.Headers = Headers;\n    self.Request = Request;\n    self.Response = Response;\n  }\n\n  exports.Headers = Headers;\n  exports.Request = Request;\n  exports.Response = Response;\n  exports.fetch = fetch;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n","import 'promise-polyfill'\nimport 'whatwg-fetch'\n\n\nexport class GreedyBandit {\n  private readonly win: Window\n  private readonly endpoint: string\n\n  private readonly token: string\n  private readonly tid: string\n  private readonly uid: string | null\n  private readonly segs: string[]\n\n  constructor(token: string, options: Options = {}) {\n    this.win = options.window || window\n    this.endpoint = options.endpoint || 'https://api.greedybandit.com'\n\n    this.token = token\n    this.tid = this.generateTid()\n    this.uid = options.uid || null\n    this.segs = options.segs || []\n\n    if (options.prefetchAssigns !== false) {\n      this.getAssigns(() => {\n        /* Prefetch to warm-up cache */\n      })\n    }\n  }\n\n  private generateTid(): string {\n    let tid = this.getCookie('_gbtid')\n    if (!tid) {\n      tid = GreedyBandit.generateTid()\n      const twoYears = 2 * 365 * 24 * 60 * 60 * 1000\n      this.setCookie('_gbtid', tid, new Date(+Time.now() + twoYears))\n    }\n    return tid\n  }\n\n  private setCookie(key: string, value: string, expireAt: Date): void {\n    this.win.document.cookie = `${key}=${value}; path=/; expires=${expireAt.toUTCString()}`\n  }\n\n  private getCookie(key: string): string | null {\n    const pairs = this.win.document.cookie.split(';')\n    for (let i = 0; i < pairs.length; i++) {\n      const [k, v] = pairs[i].split('=')\n      if (k.trim() === key) return v.trim()\n    }\n    return null\n  }\n\n  private static generateTid(): string {\n    // generete random bytes\n    const src = []\n    for (let i = 0; i < 24; i++) src.push(Math.random() * 256 | 0)\n\n    // make url-safe base64\n    const b64 = btoa(String.fromCharCode(...src))\n    return b64.replace(/\\//g, '-').replace(/\\+/g, '_')\n  }\n\n  postLog(log?: object): object {\n    const populatedLog: any = {\n      _t: this.token,\n      _tid: this.getTid(),\n      _url: this.win.location.href,\n      ...(log || {}),\n    }\n    const userId = this.getUid()\n    if (userId !== null) populatedLog['_uid'] = userId\n\n    const url = `${this.endpoint}/logs`\n\n    const win: any = this.win\n    win.fetch(url, {\n      method: 'POST',\n      headers: {'Content-Type': 'application/json; charset=utf-8'},\n      body: JSON.stringify(populatedLog)\n    })\n\n    return populatedLog\n  }\n\n  getTid(): string {\n    return this.tid\n  }\n\n  getUid(): string | null {\n    return this.uid\n  }\n\n  getSegs(): string[] {\n    return [...this.segs].sort()\n  }\n\n  getAssigns(success: (assigns: Assign[]) => void): void {\n    let qs = `public_token=${this.token}&tid=${this.tid}`\n    if (this.getUid()) qs += `&uid=${this.getUid()}`\n    if (this.getSegs().length) qs += `&segs=${this.getSegs()}`\n\n    const url = `${this.endpoint}/assignments?${qs}`\n\n    const win: any = this.win\n    win\n      .fetch(url, {\n        method: 'GET',\n        headers: {'Content-Type': 'application/json; charset=utf-8'},\n      })\n      .then((res: Response) => res.json())\n      .then((assigns: any) => assigns.map((a: any) => ({\n        expId: a['exp_id'],\n        expireDt: new Date(a['expire_dt']),\n        values: a['values']\n      })))\n      .then((assigns: Assign[]) => success(assigns))\n  }\n}\n\n\nexport type Options = {\n  window?: Window,\n  endpoint?: string,\n  prefetchAssigns?: boolean,\n  uid?: string,\n  segs?: string[],\n}\n\n\nexport type Assign = {\n  expId: string,\n  expireDt: Date,\n  values: { [id: string]: string }\n}\n\n\nexport class Time {\n  private static _preset: Date | null = null\n\n  static now(): Date {\n    return Time._preset || new Date()\n  }\n\n  static freeze(now?: Date) {\n    Time._preset = now || new Date()\n  }\n\n  static reset() {\n    Time._preset = null\n  }\n\n  static tick() {\n    if (!Time._preset) Time.freeze()\n    Time._preset = new Date(Time.now().getTime() + 1000)\n  }\n}\n"],"names":["exports","support","searchParams","self","iterable","Symbol","blob","Blob","e","formData","arrayBuffer","viewClasses","isArrayBufferView","ArrayBuffer","isView","obj","indexOf","Object","prototype","toString","call","normalizeName","name","String","test","TypeError","toLowerCase","normalizeValue","value","iteratorFor","items","iterator","next","shift","done","undefined","Headers","headers","this","map","forEach","append","Array","isArray","header","getOwnPropertyNames","consumed","body","bodyUsed","Promise","reject","fileReaderReady","reader","resolve","onload","result","onerror","error","readBlobAsArrayBuffer","FileReader","promise","readAsArrayBuffer","bufferClone","buf","slice","view","Uint8Array","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","get","type","rejected","Error","then","text","readAsText","chars","length","i","fromCharCode","join","readArrayBufferAsText","decode","json","JSON","parse","oldValue","has","hasOwnProperty","callback","thisArg","keys","push","values","entries","methods","Request","input","options","method","upcased","url","credentials","mode","signal","toUpperCase","referrer","form","trim","split","bytes","replace","decodeURIComponent","Response","bodyInit","status","ok","statusText","clone","response","redirectStatuses","redirect","RangeError","location","DOMException","err","message","stack","create","constructor","fetch","init","request","aborted","xhr","XMLHttpRequest","abortXhr","abort","rawHeaders","getAllResponseHeaders","line","parts","key","responseURL","responseText","ontimeout","onabort","open","withCredentials","responseType","setRequestHeader","addEventListener","onreadystatechange","readyState","removeEventListener","send","polyfill","defineProperty","factory","token","win","window","endpoint","tid","generateTid","uid","segs","prefetchAssigns","getAssigns","GreedyBandit","getCookie","setCookie","Date","Time","now","expireAt","document","cookie","toUTCString","pairs","_a","k","v","src","Math","random","btoa","log","populatedLog","_t","_tid","getTid","_url","href","userId","getUid","Content-Type","stringify","sort","success","qs","getSegs","res","assigns","a","expId","expireDt","_preset","freeze","getTime"],"mappings":"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"}